<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Working keyboard Demo</title>
<link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
<link rel="stylesheet" href="./sample.css">
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/a11y-dark.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.0/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
<script>
WebAudioControlsOptions={
  outline:1,
};
</script>
<script src="../webaudio-controls.js"></script>
<script src='https://g200kg.github.io/webaudio-tinysynth/webaudio-tinysynth.js'></script>

<script>
var midioutputs=[null];
var midiout=null;
var kbd=null;
function Init() {
  navigator.requestMIDIAccess({sysex:false}).then(scb,ecb);
  kbd = document.getElementById("keyboard");
  document.getElementById("midiout").addEventListener("change",function(e) {
    midiout=midioutputs[document.getElementById("midiout").selectedIndex];
  });
  kbd.addEventListener("change",function(e) {
    Send([0x90,e.note[1],e.note[0]?100:0]);
  });
  document.getElementById("prog").addEventListener("input", (e)=>{
    DisplayTimbreName(e.target.value);
    Send([0xc0,e.target.value]);
  });
  document.getElementById("volume").addEventListener("change",function(e) {
    Send([0xb0,7,e.target.value]);
  });
  DisplayTimbreName(0);
}
function ecb(e) { console.log(e); }
function scb(midiaccess) {
  var i=0;
  var outputs=midiaccess.outputs.values();
  for (var outit=outputs.next(); !outit.done; outit=outputs.next()) {
    document.getElementById("midiout").options[i++]=new Option(outit.value.name);
    midioutputs.push(outit.value);
  }
  midiout=midioutputs[0];
}
function DisplayTimbreName(val){
  const name=document.getElementById("synth").getTimbreName(0,val);
  document.getElementById("timbrename").innerText = name;
}
function Send(mess){
  if(midiout)
    midiout.send(mess);
  else
    document.getElementById("synth").send(mess);
}
window.onload=Init;
</script>
</head>
<body>
<div id="header">
  <h1>webaudio-controls</h1>
  <p>GitHub : <a href="https://github.com/g200kg/webaudio-controls">https://github.com/g200kg/webaudio-controls</a></p>
</div>
<div id="main">
  <h2>Working Keyboard Demo</h2>
  <p>This demo plays either a software-synth built into a web page or an external synth connected via the Web MIDI API
    from a GUI consisted with <b>webaduio-controls</b>.</p>
  <p>The synth built into this page is Web Audio API based "<a href="https://github.com/g200kg/webaudio-tinysynth" target="_blank">webaudio-tinysynth</a>".</p>
<hr/>
<webaudio-tinysynth id="synth"></webaudio-tinysynth>
<br/>
  MidiOut : <select id="midiout"><option>WebAudioTinySynth</option></select><br/><br/>
  Program Change: <webaudio-slider id="prog" min="0" max="127" width="256" direction="horz" valuetip="0"></webaudio-slider>
   <webaudio-param link="prog"></webaudio-param> : <span id="timbrename"></span><br/><br/>
  Volume : <webaudio-knob id="volume" min="0" max="127" value="100" diameter="64"></webaudio-knob><br/><br/>
  <webaudio-keyboard id="keyboard" min="36" keys="37" width="800" height="150"></webaudio-keyboard>
  <br/><br/>
  <p>After clicking once and `webaudio-keyboard` gets the focus, you can play with [z][x][c][v].... on your PC keyboard. 
  This demo uses the `outline` attribute to indicate that the element has focus.</p>
</div>
</body>
</html>
